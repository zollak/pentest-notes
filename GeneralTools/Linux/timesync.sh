#!/bin/bash

date
vmware-toolbox-cmd timesync disable > /dev/null
if ping -c1 -w3 10.10.10.1 >/dev/null 2>&1
then
    #echo "Ping responded; IP address allocated" >&2
    echo "Time syncing with 10.10.10.1"
    service ntp stop && ntpdate -s 10.10.10.1 && service ntp start
else
    #echo "Ping did not respond; IP address either free or firewalled" >&2
    echo "Time syncing with 0.europe.pool.ntp.org"
    service ntp stop && ntpdate -s 0.europe.pool.ntp.org && service ntp start
    # 0.europe.pool.ntp.org
    # time.nist.gov
fi
vmware-toolbox-cmd timesync enable > /dev/null
echo "vmware-toolbox-cmd timesync status:"
vmware-toolbox-cmd timesync status
#cat /sys/devices/system/clocksource/clocksource0/available_clocksource
#cat /sys/devices/system/clocksource/clocksource0/current_clocksource
#hwclock --show
#date
echo "Time sync done."
date