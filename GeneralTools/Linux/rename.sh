#!/bin/bash

# Usage ./rename.sh <username>
# Output format in case of ./rename.sh zollak: 
# <old_name>_iPhone_zollak_20171108_153833.jpg
# <old_name>_iPhone_zollak_20171108_160321.png
# <old_name>_iPhone_zollak_20171108_144147.mov

# Rename *.JPG files
for j in *.JPG; do
  # Get creation or modification date from metatag	
  if [[ -z $(exiftool $j -EXIF:CreateDate) ]]; then
  	# File has only "File Modification Date/Time" tag and "Create Date" tag is missing
  	fj=$(echo moddate_$(exiftool $j -filemodifydate | sed 's/://g' | awk -F" " '{print $4 "_" $5}' | awk -F"+" '{print $1}'))
  else
  	# File has "Create Date" tag
  	fj=$(exiftool $j -EXIF:CreateDate | sed 's/://g'| awk -F" " '{print $3 "_" $4}')
  fi
  # Orig filename without extension	
  cj=$(echo $j | awk -F"." '{print $1}')
  # Rename it 
  if [ $j != "*.JPG" ];then mv -v "$j" "$(echo $cj)_iPhone_$(echo $1)_$(echo $fj).jpg"; fi
done

# Rename *.PNG files
for p in *.PNG; do
  # Get creation date from metatag	
  fp=$(exiftool $p | grep "Date Created" | sed 's/://g'| awk -F" " '{print $3 "_" $4}')
  # Orig filename without extension	  
  cp=$(echo $p | awk -F"." '{print $1}')
  # Rename it
  if [ $p != "*.PNG" ];then mv -v "$p" "$(echo $cp)_iPhone_$(echo $1)_$(echo $fp).png"; fi
done

# Rename *.MOV files
for m in *.MOV; do	
  # Get creation date from metatag	
  fm=$(exiftool $m | grep "Media Create Date" | sed 's/://g'| awk -F" " '{print $4 "_" $5}')
  # Orig filename without extension  
  cm=$(echo $m | awk -F"." '{print $1}')
  # Rename it
  if [ $m != "*.MOV" ];then mv -v "$m" "$(echo $cm)_iPhone_$(echo $1)_$(echo $fm).mov"; fi
done

# Rename *.MP4 files
for mp4 in *.MP4; do	
  # Get creation date from metatag	
  fmp4=$(exiftool $mp4 | grep "Media Create Date" | sed 's/://g'| awk -F" " '{print $4 "_" $5}')
  # Orig filename without extension  
  cmp4=$(echo $mp4 | awk -F"." '{print $1}')
  # Rename it
  if [ $mp4 != "*.MP4" ];then mv -v "$mp4" "$(echo $cmp4)_iPhone_$(echo $1)_$(echo $fmp4).mp4"; fi
done

# Rename *.AAE files
for a in *.AAE; do
  # Get original filename of AAE file
  of=$(echo $a | awk -F"." '{print $1}')
  # Get AAE related filename
  rf=$(if [ $a != "*.AAE" ];then ls $(echo $of)_*; fi)
  # AAE related file without extension
  we=$(echo $rf | awk -F"." '{print $1}')
  # Rename it
  if [ $a != "*.AAE" ];then mv -v "$a" "$(echo $we).aae"; fi
done