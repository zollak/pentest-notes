#!/bin/bash

nmcli radio wifi off
rfkill unblock wlan

WLAN="wlan0"
 
if [ -n "$1" ]; then
    WLAN=$1
fi

echo "[*] Start DHCP and DNS server..."
sed -i "/interface/s/=.*/=${WLAN}/" /etc/dnsmasq.conf
service dnsmasq restart
 
echo "[*] Configure wlan interface..."
ifconfig $WLAN 10.0.0.1/24 up
sleep 2

echo "[*] Start hostapd daemon..."
sed -i "/interface/s/=.*/=${WLAN}/" /etc/hostapd/hostapd.conf
#service hostapd start
hostapd -B /etc/hostapd/hostapd.conf
 
echo "[*] Configure firewall..."
echo '1' >/proc/sys/net/ipv4/ip_forward
iptables -F
iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE